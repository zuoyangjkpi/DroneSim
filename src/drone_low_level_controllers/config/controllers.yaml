multicopter_controller_node:
  ros__parameters:
    # =========================
    # Control Loop Frequencies (Hz)
    # =========================
    outer_loop_frequency: 200.0  # Velocity control (50-200 Hz recommended)
    inner_loop_frequency: 500.0  # Attitude + Rate control (250-1000 Hz recommended)

    # =========================
    # Timeouts / enable
    # =========================
    velocity_setpoint_timeout: 0.8
    angular_setpoint_timeout: 0.8
    control_enabled: false  # Enabled by action modules via /drone/control/velocity_enable

    # =========================
    # Odometry convention switch
    # true  -> odom twist.linear treated as WORLD (ENU)
    # false -> odom twist.linear treated as BODY (base_link)
    # =========================
    odom_twist_in_world: false

    # =========================
    # Velocity PID (world frame) -> accel_cmd
    # =========================
    kp_vel_xy: 9.0
    ki_vel_xy: 0.45
    kd_vel_xy: 1.4

    kp_vel_z: 7.5
    ki_vel_z: 0.5
    kd_vel_z: 1.0

    vel_integral_limit: 5.0
    vel_d_filter_tau: 0.05

    # =========================
    # Attitude PI (roll/pitch -> body rates; yaw via yaw_controller)
    # =========================
    kp_att_roll: 5.5
    ki_att_roll: 0.08

    kp_att_pitch: 5.5
    ki_att_pitch: 0.12

    attitude_integral_limit: 3.0

    # =========================
    # Rate PID (body rates -> torques)
    # =========================
    kp_rate_roll: 23.0
    ki_rate_roll: 1.8
    kd_rate_roll: 0.15

    kp_rate_pitch: 23.5
    ki_rate_pitch: 2.0
    kd_rate_pitch: 0.20

    kp_rate_yaw: 35.0
    ki_rate_yaw: 1.5
    kd_rate_yaw: 0.12

    rate_integral_limit: 5.0

    # =========================
    # Limits (VERY IMPORTANT)
    # =========================
    max_tilt_angle: 0.38      # rad
    max_thrust: 150.0         # N
    min_thrust: 0.0           # N

    max_acc_xy: 3.5           # m/s^2
    max_acc_z_up: 3.5         # m/s^2
    max_acc_z_down: 3.5       # m/s^2

    max_torque_xy: 5.0        # N*m
    max_torque_z: 7.0         # N*m

    max_rate_xy: 6.0          # rad/s
    max_rate_yaw: 3.5         # rad/s

    thrust_slew_rate: 180.0   # N/s, 0 disables; e.g. 200.0 to smooth punch

    # =========================
    # Vehicle parameters
    # =========================
    vehicle_mass: 4.6
    gravity: 9.81

    inertia_xx: 0.423
    inertia_yy: 0.423
    inertia_zz: 0.828

    force_constant: 2.85e-05
    moment_constant: 0.0533

    max_motor_speed: 800.0
    min_motor_speed: 0.0
    num_motors: 8
